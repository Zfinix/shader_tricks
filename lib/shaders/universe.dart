import 'dart:convert';
import 'dart:typed_data';

import 'dart:ui';

import 'package:umbra_flutter/umbra_flutter.dart';

/// {@template universe}
/// A Dart Shader class for the `universe` shader.
/// {@endtemplate}
class Universe extends UmbraShader {
  Universe._() : super(_cachedProgram!);

  /// {@macro universe}
  static Future<Universe> compile() async {
    try {
      // Caching the program on the first compile call.
      _cachedProgram ??= await FragmentProgram.compile(
        spirv: Uint8List.fromList(base64Decode(_spirv)).buffer,
      );

      return Universe._();
    } on Exception catch (err, stackTrace) {
      throw UmbraException(err, stackTrace);
    }
  }

  static FragmentProgram? _cachedProgram;

  Shader shader({
    required Size resolution,
    required double iTime,
  }) {
    return program.shader(
      floatUniforms: Float32List.fromList([
        iTime,
        resolution.width,
        resolution.height,
      ]),
      samplerUniforms: [],
    );
  }
}

const _spirv =
    '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';
